<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ŸÇÿßÿ¶ÿØ ÿßŸÑÿµŸÅ</title>

<style>
:root{
  --accent:#1877f2;
  --bg:#f0f2f5;
  --border:#d0d7e2;
}
body{
  font-family:Cairo,Tahoma,Arial;
  background:var(--bg);
  margin:0;
}
.container{
  max-width:900px;
  margin:30px auto;
  padding:20px;
  background:#fff;
  border-radius:10px;
  border:1px solid var(--border);
}
.post{
  border:1px solid var(--border);
  padding:14px;
  border-radius:10px;
  margin-top:14px;
}
.meta{
  font-size:12px;
  color:#666;
}
.emoji-bar{
  margin-top:10px;
}

/* ===== Reaction ===== */
.react-box{
  position:relative;
  display:inline-flex;
  align-items:center;
  gap:6px;
  user-select:none;
}
.react-btn{
  cursor:pointer;
  font-size:22px;
  transition:transform .15s;
}
.react-btn:active{
  transform:scale(.9);
}
.emoji-count{
  font-size:13px;
  color:#444;
}

/* Popup (Facebook-like) */
.react-popup{
  position:absolute;
  bottom:38px;
  right:0;
  background:#fff;
  border-radius:30px;
  padding:8px 12px;
  display:flex;
  gap:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
  animation:popupIn .25s ease-out forwards;
  transform-origin:bottom right;
  z-index:20;
}
@keyframes popupIn{
  from{opacity:0; transform:translateY(10px) scale(.6);}
  to{opacity:1; transform:translateY(0) scale(1);}
}
.react-popup span{
  font-size:26px;
  cursor:pointer;
  transition:transform .15s;
}
.react-popup span:hover{
  transform:translateY(-6px) scale(1.25);
}

/* Editor */
button,input,textarea{
  padding:8px;
  border-radius:6px;
  border:1px solid var(--border);
}
.primary{
  background:var(--accent);
  color:#fff;
  border:none;
}
</style>
</head>

<body>

<div class="container">
  <h2>ŸÇÿßÿ¶ÿØ ÿßŸÑÿµŸÅ</h2>

  <button id="loginAdmin" class="primary">ÿØÿÆŸàŸÑ ADMIN</button>
  <button id="logoutBtn">ÿÆÿ±Ÿàÿ¨</button>

  <div id="editor" style="display:none;margin-top:12px">
    <input id="title" placeholder="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±"><br><br>
    <textarea id="body" placeholder="ŸÜÿµ ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±"></textarea><br><br>
    <button id="addPost" class="primary">ŸÜÿ¥ÿ±</button>
  </div>

  <div id="posts"></div>
</div>

<script>
const POSTS_KEY='qaed_posts';
const SESSION_KEY='qaed_session';
const REACT_KEY='qaed_reacts';
const EMOJIS=['üëç','‚ù§Ô∏è','üòÇ','üëè','ü§î','üòÆ'];

const getPosts=()=>JSON.parse(localStorage.getItem(POSTS_KEY)||'[]');
const savePosts=p=>localStorage.setItem(POSTS_KEY,JSON.stringify(p));
const getReacts=()=>JSON.parse(localStorage.getItem(REACT_KEY)||'{}');
const saveReacts=r=>localStorage.setItem(REACT_KEY,JSON.stringify(r));
const getSession=()=>JSON.parse(localStorage.getItem(SESSION_KEY)||'null');
const setSession=s=>{localStorage.setItem(SESSION_KEY,JSON.stringify(s));render();};

loginAdmin.onclick=()=>setSession({role:'admin',name:'ADMIN'});
logoutBtn.onclick=()=>{localStorage.removeItem(SESSION_KEY);render();};

addPost.onclick=()=>{
  const t=title.value.trim(), b=body.value.trim();
  if(!t&&!b) return;
  const p=getPosts();
  p.push({title:t,body:b,time:Date.now(),reactions:{}});
  savePosts(p);
  title.value=body.value='';
  render();
};

function reactToPost(index,emoji){
  const posts=getPosts();
  const reacts=getReacts();
  const sess=getSession()||{role:'guest',name:'ÿ∂ŸäŸÅ'};
  const userId=sess.name+'_'+sess.role;

  if(!reacts[index]) reacts[index]={};
  const prev=reacts[index][userId];

  if(prev===emoji){
    posts[index].reactions[emoji]--;
    delete reacts[index][userId];
  }else{
    if(prev) posts[index].reactions[prev]--;
    posts[index].reactions[emoji]=(posts[index].reactions[emoji]||0)+1;
    reacts[index][userId]=emoji;
  }

  savePosts(posts);
  saveReacts(reacts);
  render();
}

function render(){
  const postsDiv=document.getElementById('posts');
  postsDiv.innerHTML='';
  const sess=getSession();
  editor.style.display=sess&&sess.role==='admin'?'block':'none';

  getPosts().forEach((p,i)=>{
    const d=document.createElement('div');
    d.className='post';
    d.innerHTML=`
      <div class="meta">${new Date(p.time).toLocaleString('ar')}</div>
      <h4>${p.title}</h4>
      <div>${p.body}</div>
    `;

    const bar=document.createElement('div');
    bar.className='emoji-bar';

    const box=document.createElement('div');
    box.className='react-box';

    const reacts=getReacts();
    const sess=getSession()||{role:'guest',name:'ÿ∂ŸäŸÅ'};
    const userId=sess.name+'_'+sess.role;
    const selected=reacts[i]?.[userId] || 'üëç';

    const btn=document.createElement('span');
    btn.className='react-btn';
    btn.textContent=selected;

    const count=document.createElement('span');
    count.className='emoji-count';
    count.textContent=Object.values(p.reactions||{}).reduce((a,b)=>a+b,0);

    let popup;
    btn.onmousedown=btn.ontouchstart=()=>{
      popup=document.createElement('div');
      popup.className='react-popup';
      EMOJIS.forEach(e=>{
        const s=document.createElement('span');
        s.textContent=e;
        s.onclick=()=>{reactToPost(i,e);popup.remove();};
        popup.appendChild(s);
      });
      box.appendChild(popup);
    };
    document.addEventListener('mouseup',()=>{if(popup) popup.remove();});

    box.appendChild(btn);
    box.appendChild(count);
    bar.appendChild(box);
    d.appendChild(bar);
    postsDiv.prepend(d);
  });
}

render();
</script>

</body>
</html>
